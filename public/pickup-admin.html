<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>C.H ç²¾ç·»æ´—è¡£ - å–ä»¶è¿½è¹¤ç®¡ç†</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
    .container { max-width: 1200px; margin: 0 auto; background: #fff; border-radius: 20px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,.3); }
    h1 { color: #667eea; text-align: center; margin-bottom: 10px; font-size: 28px; }
    .subtitle { text-align: center; color: #666; margin-bottom: 30px; font-size: 14px; }
    
    /* çµ±è¨ˆå¡ç‰‡ */
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
    .stat-card { background: linear-gradient(135deg, #667eea, #764ba2); padding: 20px; border-radius: 15px; color: white; text-align: center; }
    .stat-card.tracking { background: linear-gradient(135deg, #f093fb, #f5576c); }
    .stat-card.reminded { background: linear-gradient(135deg, #ffd89b, #19547b); }
    .stat-card.picked { background: linear-gradient(135deg, #a8edea, #fed6e3); }
    .stat-number { font-size: 36px; font-weight: bold; margin-bottom: 5px; }
    .stat-label { font-size: 14px; opacity: 0.9; }
    
    /* æœå°‹å€ */
    .search-box { background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 30px; }
    .search-box input { width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 16px; }
    .search-box input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,.1); }
    
    /* å®¢æˆ¶å¡ç‰‡ */
    .customer-result { background: #f0f4ff; padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #667eea; }
    .customer-result h4 { color: #667eea; margin-bottom: 10px; }
    .customer-result p { margin: 5px 0; font-size: 14px; color: #333; }
    .customer-result button { margin-top: 10px; }
    
    /* æŒ‰éˆ• */
    .btn { padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all .3s; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102,126,234,.6); }
    .btn-small { padding: 8px 16px; font-size: 14px; }
    .btn-success { background: linear-gradient(135deg, #52c41a 0%, #389e0d 100%); }
    .btn-danger { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); }
    .btn-warning { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); }
    
    /* è¨‚å–®åˆ—è¡¨ */
    .order-item { background: #fff; padding: 20px; margin-bottom: 15px; border-radius: 12px; border: 2px solid #e0e0e0; transition: all .3s; }
    .order-item:hover { border-color: #667eea; box-shadow: 0 4px 12px rgba(102,126,234,.2); }
    .order-item.tracking { border-left: 4px solid #ffc107; }
    .order-item.reminded { border-left: 4px solid #dc3545; }
    .order-item.picked { border-left: 4px solid #28a745; opacity: 0.6; }
    
    .order-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .order-name { font-size: 18px; font-weight: bold; color: #333; }
    .order-status { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
    .status-tracking { background: #fff3cd; color: #856404; }
    .status-reminded { background: #f8d7da; color: #721c24; }
    .status-picked { background: #d4edda; color: #155724; }
    
    .order-details { font-size: 14px; color: #666; margin-bottom: 15px; }
    .order-details div { margin: 5px 0; }
    
    .order-actions { display: flex; gap: 10px; flex-wrap: wrap; }
    
    /* åˆ†é¡æ¨™ç±¤ */
    .tabs { display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 2px solid #e0e0e0; flex-wrap: wrap; }
    .tab { padding: 12px 20px; background: none; border: none; color: #666; font-size: 15px; font-weight: 600; cursor: pointer; border-bottom: 3px solid transparent; transition: all .3s; }
    .tab:hover { color: #667eea; }
    .tab.active { color: #667eea; border-bottom-color: #667eea; }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    /* è¡¨å–® */
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px; }
    input, textarea, select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 16px; transition: all .3s; }
    input:focus, textarea:focus, select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,.1); }
    textarea { min-height: 100px; resize: vertical; font-family: inherit; }
    
    /* æ‰¹é‡åŒ¯å…¥ */
    .import-area { background: #f8f9fa; padding: 20px; border-radius: 15px; border: 2px dashed #ccc; text-align: center; margin-bottom: 20px; }
    .import-area.active { border-color: #667eea; background: #f0f4ff; }
    
    /* è¨Šæ¯ */
    .message { padding: 15px; border-radius: 10px; margin-bottom: 20px; display: none; }
    .message.success { background: #d4edda; border: 2px solid #28a745; color: #155724; }
    .message.error { background: #f8d7da; border: 2px solid #dc3545; color: #721c24; }
    .message.info { background: #d1ecf1; border: 2px solid #17a2b8; color: #0c5460; }
    
    @media (max-width: 768px) {
      .container { padding: 20px; }
      h1 { font-size: 24px; }
      .stats { grid-template-columns: 1fr; }
      .order-header { flex-direction: column; align-items: flex-start; gap: 10px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§º å–ä»¶è¿½è¹¤ç®¡ç†ç³»çµ±</h1>
    <p class="subtitle">C.H ç²¾ç·»æ´—è¡£ - è‡ªå‹•æé†’å®¢äººå–ä»¶</p>

    <!-- çµ±è¨ˆå¡ç‰‡ -->
    <div class="stats">
      <div class="stat-card">
        <div class="stat-number" id="totalCount">0</div>
        <div class="stat-label">ç¸½è¿½è¹¤æ•¸</div>
      </div>
      <div class="stat-card tracking">
        <div class="stat-number" id="trackingCount">0</div>
        <div class="stat-label">è¿½è¹¤ä¸­</div>
      </div>
      <div class="stat-card reminded">
        <div class="stat-number" id="remindedCount">0</div>
        <div class="stat-label">å·²æé†’</div>
      </div>
      <div class="stat-card picked">
        <div class="stat-number" id="pickedCount">0</div>
        <div class="stat-label">å·²å–ä»¶</div>
      </div>
    </div>

    <!-- åˆ†é æ¨™ç±¤ -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('add')">â• æ–°å¢è¿½è¹¤</button>
      <button class="tab" onclick="switchTab('list')">ğŸ“‹ è¿½è¹¤æ¸…å–®</button>
      <button class="tab" onclick="switchTab('batch')">ğŸ“¦ æ‰¹é‡åŒ¯å…¥</button>
      <button class="tab" onclick="switchTab('settings')">âš™ï¸ è¨­å®š</button>
    </div>

    <!-- æ–°å¢è¿½è¹¤ -->
    <div id="add-tab" class="tab-content active">
      <div class="search-box">
        <label>ğŸ” æœå°‹å®¢æˆ¶</label>
        <input type="text" id="searchInput" placeholder="è¼¸å…¥ç·¨è™Ÿæˆ–å§“åæŸ¥è©¢å®¢æˆ¶" oninput="searchCustomer()">
        <div id="searchResult"></div>
      </div>

      <div class="form-group">
        <label>å®¢æˆ¶ç·¨è™Ÿ *</label>
        <input type="text" id="customerNumber" placeholder="ä¾‹å¦‚: 625" required>
      </div>
      <div class="form-group">
        <label>å®¢æˆ¶å§“å *</label>
        <input type="text" id="customerName" placeholder="ä¾‹å¦‚: å°æ—ç‹å­å¤§å¤§" required>
      </div>
      <div class="form-group">
        <label>LINE User ID *</label>
        <input type="text" id="userID" placeholder="U5099169723d6e83588c5f23dfaf6f9cf" required>
      </div>
      <button class="btn" onclick="startTracking()">ğŸ¯ é–‹å§‹è¿½è¹¤å–ä»¶</button>
    </div>

    <!-- è¿½è¹¤æ¸…å–® -->
    <div id="list-tab" class="tab-content">
      <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
        <button class="btn btn-small btn-success" onclick="loadOrders()">ğŸ”„ é‡æ–°æ•´ç†</button>
        <select id="filterStatus" onchange="filterOrders()" style="padding: 8px; border-radius: 8px; border: 2px solid #e0e0e0;">
          <option value="all">å…¨éƒ¨è¨‚å–®</option>
          <option value="tracking">è¿½è¹¤ä¸­</option>
          <option value="reminded">å·²æé†’</option>
          <option value="picked">å·²å–ä»¶</option>
        </select>
      </div>
      <div id="orderList"></div>
    </div>

    <!-- æ‰¹é‡åŒ¯å…¥ -->
    <div id="batch-tab" class="tab-content">
      <h3 style="color: #667eea; margin-bottom: 20px;">ğŸ“¦ æ‰¹é‡åŒ¯å…¥æ¨é€è¨˜éŒ„</h3>
      <div class="import-area" id="importArea">
        <p style="margin-bottom: 15px;">
          è«‹å¾æ´—è¡£è»Ÿä»¶è¤‡è£½ã€Œæ¨é€è¨˜éŒ„ã€ï¼Œç„¶å¾ŒæŒ‰ Ctrl+V è²¼ä¸Š
        </p>
        <button class="btn" onclick="focusImport()">ğŸ“‹ é»æ­¤è²¼ä¸Š</button>
        <textarea id="importText" style="display: none;" placeholder="è²¼ä¸Šè¤‡è£½çš„æ¨é€è¨˜éŒ„..."></textarea>
      </div>
      <div style="margin-top: 20px;">
        <button class="btn btn-success" onclick="batchImport()">ğŸ“¥ é–‹å§‹åŒ¯å…¥</button>
      </div>
      <div id="importResult" style="margin-top: 20px;"></div>
    </div>

    <!-- è¨­å®š -->
    <div id="settings-tab" class="tab-content">
      <h3 style="color: #667eea; margin-bottom: 20px;">âš™ï¸ æé†’è¨Šæ¯è¨­å®š</h3>
      <div class="form-group">
        <label>æé†’è¨Šæ¯æ¨¡æ¿</label>
        <p style="font-size: 13px; color: #666; margin-bottom: 10px;">
          å¯ç”¨è®Šæ•¸ï¼š{å®¢æˆ¶å§“å}ã€{å®¢æˆ¶ç·¨è™Ÿ}ã€{é€šçŸ¥æ—¥æœŸ}ã€{å·²éå¤©æ•¸}ã€{å·²éæ™‚æ•¸}
        </p>
        <textarea id="templateText" placeholder="ä¾‹å¦‚ï¼šè¦ªæ„›çš„ {å®¢æˆ¶å§“å}ï¼Œæ‚¨çš„è¡£ç‰©å·²æ¸…æ´—å®Œæˆè¶…é {å·²éå¤©æ•¸} å¤©ï¼Œè«‹ç›¡å¿«ä¾†é ˜å–ï¼è¨‚å–®ç·¨è™Ÿï¼š{å®¢æˆ¶ç·¨è™Ÿ}"></textarea>
      </div>
      <button class="btn btn-success" onclick="saveTemplate()">ğŸ’¾ å„²å­˜æ¨¡æ¿</button>

      <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 15px;">
        <h4 style="color: #667eea; margin-bottom: 15px;">ğŸ“Š ç³»çµ±è³‡è¨Š</h4>
        <div style="font-size: 14px; color: #666;">
          <div style="margin: 8px 0;">â° æª¢æŸ¥é »ç‡ï¼šæ¯ 2 åˆ†é˜</div>
          <div style="margin: 8px 0;">ğŸ¯ æ¸¬è©¦æ¨¡å¼ï¼š20 åˆ†é˜å¾Œæé†’</div>
          <div style="margin: 8px 0;">ğŸš€ æ­£å¼æ¨¡å¼ï¼š7 å¤©å¾Œä¸­åˆ 12:00 æé†’</div>
          <div style="margin: 8px 0;">ğŸ”„ æŒçºŒæé†’ï¼šæ¯ 7 å¤©ä¸€æ¬¡ï¼Œç›´åˆ°å–ä»¶</div>
        </div>
      </div>
    </div>

    <div id="message" class="message"></div>
  </div>

  <script>
    let allOrders = [];
    let allCustomers = [];

    // è¼‰å…¥å®¢æˆ¶è³‡æ–™
    async function loadCustomers() {
      try {
        const res = await fetch('/api/customer-numbers');
        const data = await res.json();
        if (data.success) {
          allCustomers = data.customers || [];
        }
      } catch (error) {
        console.error('è¼‰å…¥å®¢æˆ¶å¤±æ•—:', error);
      }
    }

    // æœå°‹å®¢æˆ¶
    async function searchCustomer() {
      const query = document.getElementById('searchInput').value.trim();
      const resultDiv = document.getElementById('searchResult');
      
      if (!query) {
        resultDiv.innerHTML = '';
        return;
      }

      const found = allCustomers.filter(c => 
        c.number === query || (c.name && c.name.includes(query))
      );

      if (found.length === 0) {
        resultDiv.innerHTML = '<p style="color: #999; margin-top: 10px;">æ‰¾ä¸åˆ°æ­¤å®¢æˆ¶</p>';
        return;
      }

      const customer = found[0];
      resultDiv.innerHTML = `
        <div class="customer-result">
          <h4>âœ… æ‰¾åˆ°å®¢æˆ¶</h4>
          <p><strong>ç·¨è™Ÿï¼š</strong>${customer.number}</p>
          <p><strong>å§“åï¼š</strong>${customer.name}</p>
          <p><strong>User IDï¼š</strong>${customer.userId}</p>
          <button class="btn btn-small btn-success" onclick="fillCustomer('${customer.number}', '${customer.name}', '${customer.userId}')">å¸¶å…¥è³‡æ–™</button>
        </div>
      `;
    }

    // å¸¶å…¥å®¢æˆ¶è³‡æ–™
    function fillCustomer(number, name, userId) {
      document.getElementById('customerNumber').value = number;
      document.getElementById('customerName').value = name;
      document.getElementById('userID').value = userId;
      showMessage('success', 'âœ… å·²å¸¶å…¥å®¢æˆ¶è³‡æ–™');
    }

    // é–‹å§‹è¿½è¹¤
    async function startTracking() {
      const customerNumber = document.getElementById('customerNumber').value.trim();
      const customerName = document.getElementById('customerName').value.trim();
      const userID = document.getElementById('userID').value.trim();

      if (!customerNumber || !customerName || !userID) {
        showMessage('error', 'âŒ è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½');
        return;
      }

      try {
        const res = await fetch('/api/track-pickup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ customerNumber, customerName, userID })
        });

        const data = await res.json();

        if (data.success) {
          showMessage('success', 'âœ… å·²é–‹å§‹è¿½è¹¤å–ä»¶');
          document.getElementById('customerNumber').value = '';
          document.getElementById('customerName').value = '';
          document.getElementById('userID').value = '';
          document.getElementById('searchInput').value = '';
          document.getElementById('searchResult').innerHTML = '';
          await loadOrders();
        } else {
          showMessage('error', 'âŒ ' + (data.error || data.message || 'è¿½è¹¤å¤±æ•—'));
        }
      } catch (error) {
        showMessage('error', 'âŒ é€£ç·šå¤±æ•—ï¼š' + error.message);
      }
    }

    // è¼‰å…¥è¨‚å–®
    async function loadOrders() {
      try {
        const res = await fetch('/api/tracked-orders');
        const data = await res.json();

        if (data.success) {
          allOrders = data.orders || [];
          updateStats();
          displayOrders(allOrders);
        }
      } catch (error) {
        console.error('è¼‰å…¥è¨‚å–®å¤±æ•—:', error);
      }
    }

    // æ›´æ–°çµ±è¨ˆ
    function updateStats() {
      const total = allOrders.length;
      const tracking = allOrders.filter(o => !o.reminderSent && !o.pickedUp).length;
      const reminded = allOrders.filter(o => o.reminderSent && !o.pickedUp).length;
      const picked = allOrders.filter(o => o.pickedUp).length;

      document.getElementById('totalCount').textContent = total;
      document.getElementById('trackingCount').textContent = tracking;
      document.getElementById('remindedCount').textContent = reminded;
      document.getElementById('pickedCount').textContent = picked;
    }

    // é¡¯ç¤ºè¨‚å–®
    function displayOrders(orders) {
      const listDiv = document.getElementById('orderList');

      if (!orders || orders.length === 0) {
        listDiv.innerHTML = '<p style="text-align: center; color: #999;">å°šç„¡è¿½è¹¤è¨‚å–®</p>';
        return;
      }

      let html = '';
      orders.forEach(order => {
        const status = order.pickedUp ? 'picked' : (order.reminderSent ? 'reminded' : 'tracking');
        const statusText = order.pickedUp ? 'å·²å–ä»¶' : (order.reminderSent ? 'å·²æé†’' : 'è¿½è¹¤ä¸­');
        const statusClass = order.pickedUp ? 'status-picked' : (order.reminderSent ? 'status-reminded' : 'status-tracking');
        
        const notifiedDate = new Date(order.notifiedAt).toLocaleString('zh-TW');
        const minutesPassed = Math.floor((Date.now() - new Date(order.notifiedAt).getTime()) / 60000);
        const hoursPassed = Math.floor(minutesPassed / 60);
        const daysPassed = Math.floor(hoursPassed / 24);

        html += `
          <div class="order-item ${status}">
            <div class="order-header">
              <div class="order-name">${order.customerNumber} - ${order.customerName}</div>
              <div class="order-status ${statusClass}">${statusText}</div>
            </div>
            <div class="order-details">
              <div>ğŸ“… é€šçŸ¥æ™‚é–“ï¼š${notifiedDate}</div>
              <div>â° å·²éæ™‚é–“ï¼š${daysPassed} å¤© ${hoursPassed % 24} å°æ™‚ ${minutesPassed % 60} åˆ†é˜</div>
              ${order.reminderSent ? `<div>ğŸ”” æé†’æ¬¡æ•¸ï¼š${order.reminderCount || 1} æ¬¡</div>` : ''}
              ${order.pickedUp ? `<div>âœ… å–ä»¶æ™‚é–“ï¼š${new Date(order.pickedUpAt).toLocaleString('zh-TW')}</div>` : ''}
            </div>
            <div class="order-actions">
              ${!order.pickedUp ? `<button class="btn btn-small btn-success" onclick="markPicked('${order.customerNumber}')">âœ… æ¨™è¨˜å·²å–ä»¶</button>` : ''}
              <button class="btn btn-small btn-danger" onclick="removeOrder('${order.customerNumber}')">ğŸ—‘ï¸ ç§»é™¤è¿½è¹¤</button>
            </div>
          </div>
        `;
      });

      listDiv.innerHTML = html;
    }

    // ç¯©é¸è¨‚å–®
    function filterOrders() {
      const filter = document.getElementById('filterStatus').value;
      
      if (filter === 'all') {
        displayOrders(allOrders);
        return;
      }

      const filtered = allOrders.filter(o => {
        if (filter === 'picked') return o.pickedUp;
        if (filter === 'reminded') return o.reminderSent && !o.pickedUp;
        if (filter === 'tracking') return !o.reminderSent && !o.pickedUp;
        return true;
      });

      displayOrders(filtered);
    }

    // æ¨™è¨˜å·²å–ä»¶
    async function markPicked(customerNumber) {
      if (!confirm('ç¢ºå®šæ¨™è¨˜ç‚ºå·²å–ä»¶ï¼Ÿ')) return;

      try {
        const res = await fetch('/api/pickup-complete', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ customerNumber })
        });

        const data = await res.json();

        if (data.success) {
          showMessage('success', 'âœ… å·²æ¨™è¨˜ç‚ºå·²å–ä»¶');
          await loadOrders();
        } else {
          showMessage('error', 'âŒ ' + (data.error || 'æ“ä½œå¤±æ•—'));
        }
      } catch (error) {
        showMessage('error', 'âŒ é€£ç·šå¤±æ•—ï¼š' + error.message);
      }
    }

    // ç§»é™¤è¿½è¹¤
    async function removeOrder(customerNumber) {
      if (!confirm('ç¢ºå®šç§»é™¤æ­¤è¿½è¹¤ï¼Ÿ')) return;

      try {
        const res = await fetch(`/api/tracked-order/${customerNumber}`, {
          method: 'DELETE'
        });

        const data = await res.json();

        if (data.success) {
          showMessage('success', 'âœ… å·²ç§»é™¤è¿½è¹¤');
          await loadOrders();
        } else {
          showMessage('error', 'âŒ ' + (data.error || 'æ“ä½œå¤±æ•—'));
        }
      } catch (error) {
        showMessage('error', 'âŒ é€£ç·šå¤±æ•—ï¼š' + error.message);
      }
    }

    // æ‰¹é‡åŒ¯å…¥
    function focusImport() {
      const textarea = document.getElementById('importText');
      textarea.style.display = 'block';
      textarea.focus();
    }

    async function batchImport() {
      const text = document.getElementById('importText').value.trim();
      
      if (!text) {
        showMessage('error', 'âŒ è«‹å…ˆè²¼ä¸Šæ¨é€è¨˜éŒ„');
        return;
      }

      const lines = text.split('\n').filter(line => line.trim());
      const imported = [];
      const failed = [];

      for (const line of lines) {
        const parts = line.split('\t');
        if (parts.length < 3) continue;

        const customerNumber = parts[0].trim();
        const customerName = parts[1].trim();
        const phone = parts[2].trim();

        // æŸ¥è©¢å®¢æˆ¶ User ID
        const customer = allCustomers.find(c => c.number === customerNumber || c.name === customerName);
        
        if (!customer || !customer.userId) {
          failed.push({ customerNumber, customerName, reason: 'æ‰¾ä¸åˆ° User ID' });
          continue;
        }

        try {
          const res = await fetch('/api/track-pickup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              customerNumber,
              customerName,
              userID: customer.userId
            })
          });

          const data = await res.json();
          if (data.success) {
            imported.push(customerNumber);
          } else {
            failed.push({ customerNumber, customerName, reason: data.message || 'å·²å­˜åœ¨' });
          }
        } catch (error) {
          failed.push({ customerNumber, customerName, reason: error.message });
        }
      }

      let resultHTML = `<div class="message success" style="display: block;">
        âœ… åŒ¯å…¥å®Œæˆï¼<br>
        æˆåŠŸï¼š${imported.length} ç­†<br>
        ${failed.length > 0 ? `å¤±æ•—ï¼š${failed.length} ç­†` : ''}
      </div>`;

      if (failed.length > 0) {
        resultHTML += '<div style="margin-top: 15px; font-size: 13px; color: #666;">';
        resultHTML += '<strong>å¤±æ•—é …ç›®ï¼š</strong><br>';
        failed.forEach(f => {
          resultHTML += `${f.customerNumber} - ${f.customerName}ï¼š${f.reason}<br>`;
        });
        resultHTML += '</div>';
      }

      document.getElementById('importResult').innerHTML = resultHTML;
      document.getElementById('importText').value = '';
      await loadOrders();
    }

    // å„²å­˜æ¨¡æ¿
    function saveTemplate() {
      const template = document.getElementById('templateText').value.trim();
      if (!template) {
        showMessage('error', 'âŒ è«‹è¼¸å…¥æ¨¡æ¿å…§å®¹');
        return;
      }

      // é€™è£¡å¯ä»¥å‘¼å« API å„²å­˜æ¨¡æ¿
      // æš«æ™‚åªé¡¯ç¤ºæˆåŠŸè¨Šæ¯
      showMessage('success', 'âœ… æ¨¡æ¿å·²å„²å­˜');
    }

    // åˆ‡æ›åˆ†é 
    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(tabName + '-tab').classList.add('active');

      if (tabName === 'list') {
        loadOrders();
      }
    }

    // é¡¯ç¤ºè¨Šæ¯
    function showMessage(type, text) {
      const msg = document.getElementById('message');
      msg.className = 'message ' + type;
      msg.textContent = text;
      msg.style.display = 'block';
      
      setTimeout(() => {
        msg.style.display = 'none';
      }, 5000);
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', async () => {
      await loadCustomers();
      await loadOrders();
    });
  </script>
</body>
</html>
